* TOC
{:toc}

## 概述

自 GridLinks 3.2 起，系统管理员能够使用租户配置文件为多个租户配置通用设置。
每个租户在某个时间点只有一个配置文件。

让我们逐一查看租户配置文件中可用的设置。

## 实体限制

这组设置允许系统管理员配置每个租户能够创建的最大实体数。

**GridLinks Community** 版本支持以下实体的限制：设备、资产、客户、用户、仪表板和规则链。

**GridLinks Professional** 版本支持上述所有内容的限制，以及以下实体的额外约束支持：集成、转换器和调度程序事件。

{% include images-gallery.html imageCollection="entityLimits" %}

## API 限制和使用情况

这组设置允许系统管理员配置每个租户每月可以执行的最大消息数、API 调用数等。GridLinks 会持续收集和分析有关 API 使用情况的统计信息。统计信息的典型更新间隔为 1 分钟

GridLinks 会跟踪六个主要组件的 API 使用情况：传输、规则引擎、JS 函数、遥测持久性、电子邮件和短信服务。如果其中一个相关的 API 限制达到阈值，平台会禁用该组件。
例如，如果租户设备每月产生超过 1 亿条消息，平台会禁用属于此租户的所有设备的连接。
当 API 使用情况被禁用或达到某个阈值（通常为 80%）时，GridLinks 会通过电子邮件通知租户管理员。

让我们分别查看每个限制：

**传输消息**是指设备发送到服务器的任何消息。这可能是遥测、属性更新、RPC 调用等。

**传输数据点**是指遥测或属性消息包含的键值对数。
例如，下面列出的消息包含 5 个数据点，因为“jsonKey”对应一个数据点。

```json
{
 "stringKey":"value1", 
 "booleanKey":true, 
 "doubleKey":42.0, 
 "longKey":73, 
 "jsonKey": {
    "someNumber": 42,
    "someArray": [1,2,3],
    "someNestedObject": {"key": "value"}
 }
}
```

**注意**：如果字符串或 JSON 键的值大于 512 个字符，平台会将其计为多个数据点。

**规则引擎执行**是指属于当前租户的规则节点的任何执行。处理单个遥测消息可能会导致多个规则引擎执行。
平台还会计算由生成器节点等产生的定期消息。

**JavaScript 执行**是指租户管理员定义的自定义函数的任何执行。例如，处理“脚本”过滤器或转换节点、调用数据转换器等。

**数据点存储天数**是针对存储在数据库中的所有时序数据点计算的。
平台将数据点数量乘以这些数据点将存储的天数。TTL 参数用于提取存储数据的日期数。
例如，如果您将 3 个数据点存储 30 天，则这是 90 个存储数据点天。
系统管理员能够使用租户配置文件中的“**默认存储 TTL 天数**”参数配置默认 TTL。
租户管理员能够使用“**保存时序**”规则节点配置或使用发布遥测请求中的“TTL”参数覆盖默认 TTL。

**警报 TTL**是指在数据库中存储警报的天数。

**发送的警报**是指在该期间（默认情况下为一个月）内创建的警报总数。

**发送的电子邮件**是指使用系统 SMTP 提供程序（设置）从规则引擎发送的电子邮件数。
请注意，租户管理员能够在平台的社区版和专业版中定义自定义 SMTP 设置。
使用自定义 SMTP 设置发送的电子邮件不会影响 API 限制。

**发送的短信**是指使用系统短信提供程序从规则引擎发送的短信数。
请注意，租户管理员能够在平台的社区版和专业版中定义自定义短信提供程序设置。
使用自定义 SMTP 设置发送的短信不会影响 API 限制。

### API 使用情况仪表板

作为租户管理员，您可以查看 API 使用情况仪表板。
下面的仪表板允许租户管理员详细了解他们的每小时/每天/每月的 API 使用情况，并即时查看 API 限制的状态。

{% include images-gallery.html imageCollection="apiLimitsDashboard" %}

## 速率限制

这组设置允许系统管理员配置平台应为特定设备（设备级）或属于单个租户的所有设备（租户级）处理的最大请求数。
速率限制的实现基于[令牌桶](https://en.wikipedia.org/wiki/Token_bucket)算法。

速率限制定义由值和时间间隔组成。例如，“1000:60”表示“每 60 秒不超过 1000 条消息”。
您可以用“,”定义多个间隔。例如，“100:1,1000:60”表示“每秒 100 条消息的突发，但每 60 秒不超过 1000 次”。

{% include images-gallery.html imageCollection="rateLimits" %}

## 在隔离的 GridLinks 规则引擎队列中处理

GridLinks 规则引擎是集群中的主要“工作器”，负责处理传入的消息。

默认情况下，所有消息（例如遥测、连接和生命周期事件）都会推送到相同的消息队列/主题（由 Kafka、RabbitMQ、AWS SQS、Azure Service Bus、Google Pub/Sub 提供支持）。
当隔离处理被禁用（默认）时，GridLinks 会将所有租户的消息推送到一个公共队列。

当您选择将处理隔离到特定租户时，GridLinks 会将消息推送到单独的队列。
这为这些租户提供了更好的隔离级别。您需要创建启用了“使用隔离的 GridLinks 规则引擎队列”框的租户配置文件，并将其分配给特定租户，或更新现有的租户配置文件。
这将指示规则引擎订阅包含相应租户数据的特定消息队列主题。

您也可以设置一个单独的规则引擎实例，该实例仅负责特定租户配置文件的租户。
请参阅[配置参数](/docs/user-guide/install/config/#thingsboard-service-parameters)。

### 隔离租户的队列配置

{% include images-gallery.html imageCollection="isolatedQueueConfiguration" showListImageTitles="true"%}

为特定租户分配租户配置文件后，配置的队列会自动创建并启动，并准备好用于规则链或设备配置文件。

有关队列设置的更多信息，请参阅[指南](/docs/{{docsPrefix}}user-guide/rule-engine-2-5/queues/#queue-settings)